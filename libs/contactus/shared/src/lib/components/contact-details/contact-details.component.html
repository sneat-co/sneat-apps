@let contact = $contact();

<!--<p>$contact().dbo: {{ $contact()?.dbo|json }}</p>-->

<!--<p>$relatedToContactOfCurrentUser: {{ $relatedToContactOfCurrentUser()|json }};</p>-->

<ion-grid class="ion-grid-layout">
	<ion-row>
		<ion-col>
			<ion-card>
				<ion-item class="sneat-no-end-padding">
					<ion-label style="font-weight: bold">
						@if (contact?.brief?.gender) {
							<span class="ion-margin-end">
								@switch (contact?.brief?.gender) {
									@case ("male") {
										ðŸ§‘
									}
									@case ("female") {
										ðŸ‘©
									}
									@default {
										<ion-icon name="person" />
									}
								}
							</span>
							{{
								(contact | contactTitle) ||
									contact?.brief?.shortTitle ||
									(contact?.brief?.userID === currentUserId
										? "Me"
										: "(no title)")
							}}
						}
					</ion-label>
					<ion-buttons slot="end">
						<ion-button
							color="medium"
							title="Edit member"
							(click)="goMemberPage('edit-member')"
						>
							<ion-icon name="create" />
						</ion-button>
					</ion-buttons>
				</ion-item>
				@if (contact?.brief?.gender && $relatedToUserAs(); as relatedToUserAs) {
					@switch (relatedToUserAs) {
						@case ("child") {
							@switch (contact?.brief?.gender) {
								@case ("male") {
									<ion-item-divider mode="md">
										<ion-label>My son</ion-label>
									</ion-item-divider>
								}
								@case ("female") {
									<ion-item-divider mode="md">
										<ion-label>My daughter</ion-label>
									</ion-item-divider>
								}
							}
						}
						@case ("spouse") {
							@switch (contact?.brief?.gender) {
								@case ("male") {
									<ion-item-divider mode="md">
										<ion-label>My husband</ion-label>
									</ion-item-divider>
								}
								@case ("female") {
									<ion-item-divider mode="md">
										<ion-label>My wife</ion-label>
									</ion-item-divider>
								}
							}
						}
					}
				}
				<sneat-contact-dob [contact]="contactWithBriefAndOptionalDto" />
			</ion-card>

			<ion-card>
				<sneat-gender-form
					lastItemLines="none"
					[hideSkipButton]="false"
					[$spaceID]="$spaceID()"
					[$contactID]="$contact()?.id"
					[$genderID]="contact?.dbo?.gender"
					(genderChange)="onGenderChanged($event)"
				/>
			</ion-card>

			@if ($isMember() && contact?.brief?.userID !== currentUserID) {
				<sneat-relationship-form
					[$space]="$space()"
					[$relatedTo]="$relatedToContactOfCurrentUser()"
					[$relatedItems]="contact?.dbo?.related || contact?.brief?.related"
					[$ageGroup]="contact?.brief?.ageGroup"
					(relatedAsChange)="onRelatedAsChanged($event)"
				/>
			}
		</ion-col>
		<ion-col>
			<ion-card>
				<ion-list>
					<sneat-contact-modules-menu
						[$space]="$space()"
						[contact]="contactWithBriefAndOptionalDto"
					/>
				</ion-list>
			</ion-card>
		</ion-col>
	</ion-row>
</ion-grid>

<ion-segment class="ion-margin-horizontal" color="primary" [(ngModel)]="tab">
	<ion-segment-button value="peers"> Peers</ion-segment-button>
	@if (hideForContactTypes(["pet"])) {
		<ion-segment-button value="communicationChannels">
			Email/Phone
		</ion-segment-button>
		<ion-segment-button value="roles"> Roles</ion-segment-button>
		<ion-segment-button value="locations"> Locations</ion-segment-button>
	}
</ion-segment>

@switch (tab) {
	@case ("communicationChannels") {
		<sneat-contact-contacts [contact]="contactWithBriefAndOptionalDto" />
	}
	@case ("peers") {
		<sneat-related-contacts
			[$space]="$space()"
			[$related]="$contact()?.dbo?.related"
		/>
	}
	@case ("locations") {
		<sneat-contact-locations
			[$space]="$space()"
			[contact]="contactWithBriefAndOptionalDto"
		/>
	}
	@case ("roles") {
		<sneat-contact-roles-input
			[space]="$space()"
			[contact]="contactWithBriefAndOptionalDto"
		/>
	}
}
