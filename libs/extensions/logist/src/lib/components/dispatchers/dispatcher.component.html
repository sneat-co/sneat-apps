<ion-card>
	<ion-item-divider color="light" class="sneat-no-end-padding">
		<ion-label
			style="font-weight: bold"
			[class.deleting-list-item]="deleting"
			slot="start"
		>
			{{ counterparty?.countryID | countryFlag }}
			{{ counterparty?.title }}
		</ion-label>
		<ion-label color="medium">Ref</ion-label>
		<ion-input
			placeholder="#"
			[formControl]="refNumber"
			(keyup.enter)="saveChanges()"
		/>
		<ion-buttons slot="end">
			@if (!form.dirty) {
				<ion-button
					color="medium"
					[disabled]="deleting"
					title="Remove from the order counterparty & related container points"
					(click)="deleteDispatcher()"
				>
					@if (!deleting) {
						<ion-icon name="trash-outline" slot="end" />
					}
					@if (deleting) {
						<ion-label>deleting...</ion-label>
					}
					@if (!deleting) {
						<ion-label>Delete</ion-label>
					}
					@if (deleting) {
						<ion-spinner name="lines-small" slot="start" />
					}
				</ion-button>
			}
			@if (form.dirty) {
				<ion-button (click)="saveChanges()">
					<ion-icon name="save-outline" slot="start" />
					@if (!saving) {
						<ion-label>Save changes</ion-label>
					}
					@if (saving) {
						<ion-label>Saving...</ion-label>
					}
					@if (saving) {
						<ion-spinner name="lines-small" color="medium" />
					}
				</ion-button>
			}
			@if (form.dirty && !saving) {
				<ion-button (click)="cancelChanges()" color="medium">
					<ion-icon name="close-circle-outline" slot="start" />
					<ion-label>Cancel</ion-label>
				</ion-button>
			}
		</ion-buttons>
	</ion-item-divider>

	<!--	<ion-item>-->
	<!--		<ion-label color="medium" position="floating">Special instructions</ion-label>-->
	<!--		<ion-textarea rows="2" autoGrow="true" [formControl]="specialInstructions"-->
	<!--									(keyup.enter)="saveChanges()"></ion-textarea>-->
	<!--	</ion-item>-->

	<ion-item lines="none">
		<ion-label color="medium"><b>Shipping points</b></ion-label>
		<ion-buttons slot="end" (click)="addShippingPoint($event)">
			<ion-button color="medium">
				<ion-icon name="add-outline" slot="start" />
				<ion-label>Add</ion-label>
			</ion-button>
		</ion-buttons>
	</ion-item>

	@for (location of locations; track counterpartyKey($index, location)) {
		<sneat-dispatch-point
			[dispatchPoint]="location"
			[disabled]="deleting"
			[deleting]="deleting"
			[order]="order"
		/>
	}
</ion-card>
